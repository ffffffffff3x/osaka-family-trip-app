<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSAKA Family Trip</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f8f8f8;
            color: #382414;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            width: 100%;
            max-width: 600px;
            background-color: #A0522D;
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }

        .header a {
            color: white;
            text-decoration: none;
            font-size: 20px;
            margin-right: 15px;
        }

        .header h1 {
            margin: 0;
            font-size: 20px;
            flex-grow: 1;
            text-align: center;
            padding-right: 35px;
        }
        
        .content {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        .summary-box { background-color: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); margin-bottom: 20px; }
        .total-display { text-align: center; margin-bottom: 20px; }
        .total-display h2 { font-size: 16px; color: #666; margin-bottom: 5px; }
        .total-amount { font-size: 38px; font-weight: bold; color: #382414; }
        .filter-buttons { display: flex; justify-content: center; gap: 10px; margin-bottom: 10px; }
        .filter-btn { background-color: #f0f0f0; color: #382414; border: 1px solid #ddd; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        .filter-btn.active { background-color: #A0522D; color: white; }

        .account-item { background-color: white; padding: 15px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .account-details { flex-grow: 1; }
        .account-name { font-size: 17px; font-weight: 500; }
        .status-tags { font-size: 12px; margin-top: 5px; }
        .tag-payer, .tag-status { display: inline-block; padding: 2px 6px; border-radius: 4px; font-weight: bold; margin-right: 5px; }
        .tag-payer { background-color: #D7C49E; color: #382414; }
        .tag-paid { background-color: #e6f7d5; color: #5cb85c; }
        .tag-unpaid { background-color: #ffe8e8; color: #f0ad4e; }

        .account-amount { font-size: 20px; font-weight: bold; color: #382414; }

        .add-button-container { width: 100%; max-width: 600px; padding: 20px; position: fixed; bottom: 0; background-color: #f8f8f8; border-top: 1px solid #ddd; text-align: center; z-index: 100; }
        #addButton { width: 90%; padding: 15px; background-color: #382414; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }

        /* è¼¸å…¥å½ˆçª— (Modal) æ¨£å¼ */
        .modal { display: none; position: fixed; z-index: 200; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; width: 100%; max-width: 600px; position: absolute; bottom: 0; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); border-top-left-radius: 12px; border-top-right-radius: 12px; padding: 20px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-close { color: #aaa; font-size: 28px; font-weight: bold; cursor: pointer; }
        
        .input-form-group { margin-bottom: 20px; }
        .input-form-group label { display: block; font-size: 15px; color: #666; margin-bottom: 5px; }
        
        .input-form-group input[type="text"], 
        .input-form-group input[type="number"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; box-sizing: border-box; }
        
        .amount-group { display: flex; align-items: center; border: 1px solid #ddd; border-radius: 6px; }
        .amount-group input { border: none !important; padding: 10px; font-size: 24px !important; flex-grow: 1; }
        
        .currency-label { padding: 0 10px; font-size: 18px; color: #A0522D; font-weight: bold; border-left: 1px solid #ddd; }
        
        .conversion-tip { font-size: 14px; color: #007bff; margin-top: 5px; text-align: right; }
    </style>
</head>
<body>
    <div class="header">
        <a href="index.html">â€¹</a>
        <h1>ğŸ’´ æ—…éŠè¨˜å¸³æœ¬</h1>
    </div>

    <div class="content">
        <div class="summary-box">
            <div class="total-display">
                <h2>ç¸½é‡‘é¡ (å°å¹£)</h2>
                <div class="total-amount" id="totalAmount">$452,385</div>
            </div>

            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="All">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="K">K</button>
                <button class="filter-btn" data-filter="M">M</button>
                <button class="filter-btn" data-filter="E">E</button>
                <button class="filter-btn" data-filter="J">J</button>
            </div>
        </div>
        
        <div class="list-container" id="accountList">
        </div>
    </div>

    <div class="add-button-container">
        <button id="addButton">ï¼‹ è¨˜ä¸€ç­†</button>
    </div>

    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ–°å¢æ¬¾é …</h2>
                <span class="modal-close" id="closeModal">&times;</span>
            </div>
            
            <form id="expenseForm">
                <div class="input-form-group">
                    <label for="itemName">é …ç›®åç¨± (ä¾‹å¦‚ï¼šè¶…å•†é›¶é£Ÿ)</label>
                    <input type="text" id="itemName" placeholder="å¿…å¡«" required>
                </div>

                <div class="input-form-group">
                    <label for="jpyAmount">æ—¥å¹£é‡‘é¡</label>
                    <div class="amount-group">
                        <input type="number" id="jpyAmount" placeholder="0" required>
                        <span class="currency-label">JPY</span>
                    </div>
                    <div class="conversion-tip" id="twdConversion">ç´„ç­‰æ–¼å°å¹£ (TWD): 0</div>
                </div>
                
                <div class="input-form-group">
                    <label>ä»˜æ¬¾äºº (æœªä¾†å¯é»é¸é ­åƒ)</label>
                    <input type="text" value="K" disabled> 
                </div>

                <button type="submit" style="width: 100%; padding: 12px; background-color: #A0522D; color: white; border: none; border-radius: 6px; font-size: 16px; margin-top: 10px;">å„²å­˜è‡³é›²ç«¯</button>
            </form>
        </div>
    </div>


    <script>
        const accountData = [
            { name: "ç”±å¸ƒé™¢ç‰ä¹‹æ¹¯ x1æ™š", payer: "K", amount: 55941, paid: false },
            { name: "Grand Hyatt Fukuoka x3æ™š", payer: "K", amount: 123105, paid: true },
            { name: "è§€å…‰åˆ—è»Šè»Šç¥¨", payer: "K", amount: 24895, paid: true },
            { name: "D1 åˆé¤ é­šé£¯æ™‚", payer: "K", amount: 3458, paid: true },
            { name: "æ™šé¤ (é¤å»³)", payer: "M", amount: 20000, paid: false },
            { name: "ç§Ÿè»Šè²»ç”¨", payer: "E", amount: 15000, paid: true }
        ];

        let currentFilter = 'All'; 
        const accountList = document.getElementById('accountList');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const currentRate = 0.22; 

        function renderAccountList() {
            accountList.innerHTML = '';
            
            const filteredData = accountData.filter(item => {
                return currentFilter === 'All' || item.payer === currentFilter;
            });

            const total = filteredData.reduce((sum, item) => sum + item.amount, 0);
            document.getElementById('totalAmount').textContent = `$${total.toLocaleString('en-US')}`;

            filteredData.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'account-item';
                
                const statusTagClass = item.paid ? 'tag-paid' : 'tag-unpaid';
                const statusText = item.paid ? 'å·²ä»˜' : 'æœªä»˜';

                itemDiv.innerHTML = `
                    <div class="account-details">
                        <div class="account-name">${item.name}</div>
                        <div class="status-tags">
                            <span class="tag-payer">${item.payer}</span>
                            <span class="tag-status ${statusTagClass}">${statusText}</span>
                        </div>
                    </div>
                    <div class="account-amount">$${item.amount.toLocaleString('en-US')}</div>
                `;
                accountList.appendChild(itemDiv);
            });

            if (filteredData.length === 0) {
                 accountList.innerHTML = '<div style="text-align:center; padding: 40px; color:#999;">ç›®å‰æ²’æœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„é …ç›®</div>';
            }
        }
        
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('active'));
                currentFilter = button.dataset.filter;
                button.classList.add('active');
                renderAccountList();
            });
        });

        const expenseModal = document.getElementById('expenseModal');
        const addButton = document.getElementById('addButton');
        const closeModal = document.getElementById('closeModal');
        const jpyAmountInput = document.getElementById('jpyAmount');
        const twdConversionDiv = document.getElementById('twdConversion');
        const expenseForm = document.getElementById('expenseForm');
        
        addButton.onclick = function() {
            expenseModal.style.display = "flex";
            jpyAmountInput.focus();
        }
        
        closeModal.onclick = function() {
            expenseModal.style.display = "none";
            expenseForm.reset();
            twdConversionDiv.textContent = 'ç´„ç­‰æ–¼å°å¹£ (TWD): 0';
        }
        
        window.onclick = function(event) {
            if (event.target == expenseModal) {
                expenseModal.style.display = "none";
                expenseForm.reset();
                twdConversionDiv.textContent = 'ç´„ç­‰æ–¼å°å¹£ (TWD): 0';
            }
        }

        jpyAmountInput.addEventListener('input', () => {
            const jpyAmount = parseFloat(jpyAmountInput.value) || 0;
            const twdAmount = (jpyAmount * currentRate);
            
            const formattedTWD = Math.round(twdAmount).toLocaleString('en-US'); 
            
            twdConversionDiv.textContent = `ç´„ç­‰æ–¼å°å¹£ (TWD): ${formattedTWD}`;
        });
        
        expenseForm.onsubmit = function(event) {
            event.preventDefault();
            
            const itemName = document.getElementById('itemName').value;
            const jpyAmount = parseFloat(jpyAmountInput.value);
            const twdAmount = Math.round(jpyAmount * currentRate);

            if (itemName && jpyAmount > 0) {
                alert(`æˆåŠŸå„²å­˜ï¼\né …ç›®: ${itemName}\næ—¥å¹£: ${jpyAmount} JPY\nå°å¹£æ›ç®—: ${twdAmount} TWD\n(æœªé€£ç·š Firebaseï¼Œæ•…ä¸æœƒçœŸæ­£æ–°å¢åˆ°åˆ—è¡¨)`);
                
                expenseModal.style.display = "none";
                expenseForm.reset();
                twdConversionDiv.textContent = 'ç´„ç­‰æ–¼å°å¹£ (TWD): 0';
            } else {
                alert('è«‹ç¢ºèªé …ç›®åç¨±å’Œé‡‘é¡æ˜¯å¦æ­£ç¢ºï¼');
            }
        }

        renderAccountList();
    </script>
</body>
</html>