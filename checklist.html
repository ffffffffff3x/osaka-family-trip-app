<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSAKA FAMILY TRIP - è¡Œæ</title>
    <!-- Firebase Libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        /* è®Šæ•¸è¨­ç½® */
        :root {
            --main-color: #955f47;
            --text-color: #382414;
            --white-bg: #ffffff;
            --emergency-red: #d9534f;
            --safe-green: #28a745;
            --highlight-orange: #ffc107;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--white-bg);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-top: 95px;
            font-size: 14px;
        }

        /* å°èˆªæ¬„æ¨£å¼ (èˆ‡ flight.html ç›¸åŒ) */
        .fixed-nav-header {
            width: 100%;
            max-width: 600px;
            position: fixed;
            top: 0;
            z-index: 1000;
            background-color: var(--white-bg);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .simple-title-bar { padding: 8px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .simple-title-text { text-align: center; flex-grow: 1; }
        .simple-title-text h1 { color: var(--main-color); font-size: 17px; margin: 0; line-height: 1.2; }
        .simple-title-text p { color: #666; font-size: 12px; margin: 0; }
        .simple-title-bar a { color: var(--text-color); text-decoration: none; font-size: 18px; margin: 0 5px; }

        .nav-bar-wrapper { display: flex; background-color: var(--white-bg); padding: 5px 0 10px 0; border-bottom: 1px solid #eee; justify-content: center; }
        .function-tabs { display: flex; justify-content: space-around; width: 100%; max-width: 580px; }
        .function-tab { padding: 5px 8px; color: #999; text-decoration: none; font-size: 11px; font-weight: 500; display: flex; flex-direction: column; align-items: center; }
        .function-tab.active { color: var(--main-color); }
        .function-icon { font-size: 20px; margin-bottom: 2px; line-height: 1; }

        /* ------------------------------------------------ */
        /* ----- é é¢å…§å®¹æ¨£å¼ (è¡Œææ¸…å–®) ----- */
        /* ------------------------------------------------ */
        .container { width: 100%; max-width: 600px; padding: 15px; margin: 0 auto; }
        
        .input-area {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            border-bottom: 2px solid var(--main-color);
        }

        #itemInput { flex-grow: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        #categorySelect { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; background-color: #fff; color: var(--text-color); }
        #addItemBtn { padding: 8px 15px; background-color: var(--main-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold; }

        .section-title {
            font-size: 15px;
            font-weight: bold;
            color: var(--main-color);
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        /* æ¸…å–®é …ç›® - æ¥µç°¡ç·šæ¢ */
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 10px 10px 10px 5px;
            margin-bottom: 8px;
            border-left: 5px solid transparent; 
            border-bottom: 1px solid #f5f5f5;
            background-color: var(--white-bg);
            border-radius: 4px;
        }

        .checklist-item.border-red { border-left-color: var(--emergency-red); }
        .checklist-item.border-orange { border-left-color: var(--highlight-orange); }
        .checklist-item.border-green { border-left-color: var(--safe-green); }
        .checklist-item.border-main { border-left-color: var(--main-color); }

        .item-text {
            flex-grow: 1;
            padding: 0 10px;
            font-size: 15px;
            transition: text-decoration 0.3s, color 0.3s;
        }

        .item-text.checked { text-decoration: line-through; color: #aaa; }

        .delete-btn { background: none; border: none; color: #aaa; font-size: 20px; line-height: 1; cursor: pointer; margin-left: 10px; padding: 5px; }

        /* è‡ªå®šç¾© Checkbox æ¨£å¼ (æ¥µç°¡åœ“å½¢) */
        .checkbox-container { display: block; position: relative; padding-left: 25px; margin-bottom: 0; cursor: pointer; font-size: 14px; user-select: none; }
        .checkbox-container input { position: absolute; opacity: 0; cursor: pointer; height: 0; width: 0; }
        .checkmark { position: absolute; top: 0; left: 0; height: 18px; width: 18px; background-color: #eee; border-radius: 50%; transition: background-color 0.2s; }
        .checkbox-container:hover input ~ .checkmark { background-color: #ccc; }
        .checkbox-container input:checked ~ .checkmark { background-color: var(--main-color); }
        .checkbox-container .checkmark:after { content: ""; position: absolute; display: none; left: 6px; top: 3px; width: 5px; height: 10px; border: solid white; border-width: 0 3px 3px 0; transform: rotate(45deg); }
        .checkbox-container input:checked ~ .checkmark:after { display: block; }
    </style>
</head>
<body>
    <div class="fixed-nav-header">
        <div class="simple-title-bar">
            <a href="flight.html">âœ•</a> 
            <div class="simple-title-text">
                <h1>OSAKA FAMILY TRIP</h1>
                <p>å¤§é˜ªæ—…éŠ 2026</p>
            </div>
            <a href="info.html">â“˜</a>
        </div>
        
        <div class="nav-bar-wrapper">
            <div class="function-tabs">
                <a href="flight.html" class="function-tab">
                    <span class="function-icon">ğŸ“…</span><span>è¡Œç¨‹</span>
                </a>
                <a href="checklist.html" class="function-tab active">
                    <span class="function-icon">ğŸ§³</span><span>è¡Œæ</span>
                </a>
                <a href="exchange.html?mode=rate" class="function-tab">
                    <span class="function-icon">ğŸ’´</span><span>æ›åŒ¯</span>
                </a>
                <a href="exchange.html?mode=budget" class="function-tab">
                    <span class="function-icon">ğŸ§¾</span><span>è¨˜å¸³</span>
                </a>
                <a href="info.html" class="function-tab">
                    <span class="function-icon">ğŸš¨</span><span>è³‡è¨Š</span>
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        
        <div class="input-area">
            <select id="categorySelect">
                <option value="è­‰ä»¶/é‡‘éŒ¢">è­‰ä»¶/é‡‘éŒ¢</option>
                <option value="è¡£ç‰©/é…ä»¶" selected>è¡£ç‰©/é…ä»¶</option>
                <option value="è—¥å“/è¡›ç”Ÿ">è—¥å“/è¡›ç”Ÿ</option>
                <option value="é›»å­/é›œé …">é›»å­/é›œé …</option>
                <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
            <input type="text" id="itemInput" placeholder="æ–°å¢é …ç›®ï¼ŒæŒ‰Enter...">
            <button id="addItemBtn" onclick="addItem()">ï¼‹</button>
        </div>

        <div id="checklist">
            <p style="text-align: center; color: #999;">è¼‰å…¥è¡Œææ¸…å–®ä¸­...</p>
        </div>

    </div>

    <script>
        // ----------------------------------------------------
        // ã€é›²ç«¯é…ç½®å€ã€‘
        // ----------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyBGmvolsS8AgPfm09qynSVIz5GOcvXDKCM",
            authDomain: "osaka-family-trip.firebaseapp.com",
            databaseURL: "https://osaka-family-trip-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "osaka-family-trip",
            storageBucket: "osaka-family-trip.firebasestorage.app",
            messagingSenderId: "303743481222",
            appId: "1:303743481222:web:e3e4ecb51ff89a3acfe807"
        };
        
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (error) {
            console.error("Firebase Initialization Error:", error);
        }
        
        const checklistRef = database ? database.ref('luggage_checklist') : null;
        
        // --- é‚è¼¯å€ ---
        function renderChecklist(items) {
            const listElement = document.getElementById('checklist');
            if (!listElement) return;

            const itemsArray = items ? Object.keys(items).map(key => ({ ...items[key], key })) : [];
            const sortedItems = itemsArray.sort((a, b) => {
                if (a.category < b.category) return -1;
                if (a.category > b.category) return 1;
                if (a.checked === b.checked) {
                    return (a.timestamp || 0) - (b.timestamp || 0);
                }
                return a.checked ? 1 : -1;
            });

            let html = '';
            let currentCategory = '';
            const categoryColors = {
                'è­‰ä»¶/é‡‘éŒ¢': 'border-red',
                'è¡£ç‰©/é…ä»¶': 'border-orange',
                'è—¥å“/è¡›ç”Ÿ': 'border-green',
                'é›»å­/é›œé …': 'border-main',
                'å…¶ä»–': 'border-main'
            };

            if (sortedItems.length === 0 && itemsArray.length === 0) {
                 listElement.innerHTML = `<p style="text-align: center; color: #666; padding: 20px;">æ¸…å–®æ˜¯ç©ºçš„ï¼Œæ–°å¢ç¬¬ä¸€é …å§ï¼</p>`;
                 return;
            }

            sortedItems.forEach(item => {
                if (item.category !== currentCategory) {
                    currentCategory = item.category;
                    html += `<div class="section-title" style="margin-top: 25px;">${currentCategory}</div>`;
                }

                const lineClass = categoryColors[item.category] || 'border-main';

                html += `
                    <div class="checklist-item ${lineClass}" data-id="${item.key}">
                        <label class="checkbox-container">
                            <input type="checkbox" data-id="${item.key}" ${item.checked ? 'checked' : ''} onclick="updateItemChecked('${item.key}', this.checked)">
                            <span class="checkmark"></span>
                        </label>
                        <span class="item-text ${item.checked ? 'checked' : ''}">${item.name}</span>
                        <button class="delete-btn" data-id="${item.key}" onclick="deleteItem('${item.key}')">&times;</button>
                    </div>
                `;
            });
            
            listElement.innerHTML = html;
        }

        window.addItem = function() {
            const input = document.getElementById('itemInput');
            const categorySelect = document.getElementById('categorySelect');
            const itemName = input.value.trim();
            const category = categorySelect.value;
            
            if (!itemName || !category || !checklistRef) {
                alert('è«‹ç¢ºèªè¼¸å…¥é …ç›®ä¸¦æª¢æŸ¥ Firebase é€£ç·šã€‚');
                return;
            }

            checklistRef.push({
                name: itemName,
                checked: false,
                category: category,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                input.value = '';
            }).catch(error => {
                console.error("Error adding item:", error);
            });
        }

        window.updateItemChecked = function(key, checked) {
            if (!checklistRef) return;
            checklistRef.child(key).update({
                checked: checked
            }).catch(error => {
                console.error("Error updating item:", error);
            });
        }

        window.deleteItem = function(key) {
            if (!checklistRef) return;
            if(confirm('ç¢ºèªåˆªé™¤æ­¤æ¸…å–®é …ç›®ï¼Ÿ')) {
                checklistRef.child(key).remove().catch(error => {
                    console.error("Error deleting item:", error);
                });
            }
        }

        // --- åˆå§‹åŒ– ---
        window.onload = () => {
            if (checklistRef) {
                checklistRef.on('value', (snapshot) => {
                    const items = snapshot.val();
                    renderChecklist(items);
                });
            } else {
                 document.getElementById('checklist').innerHTML = `<p style="color: red; text-align: center;">Firebase é€£ç·šå¤±æ•—ï¼Œç„¡æ³•è¼‰å…¥æ¸…å–®ã€‚</p>`;
            }
            
            document.getElementById('itemInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('addItemBtn').click();
                }
            });
        };
    </script>
</body>
</html>

